language: c
sudo: required
dist: trusty
services:
  - docker
cache:
  apt: true
  directories:
    - $HOME/.opam
    - $HOME/.sbt
    - $HOME/.ivy2
    - $HOME/.apk-cache
before_cache:
  - rm -rfv $HOME/.opam/log
install: bash -ex .travis-install.sh
script: bash -ex .travis-script.sh
after_success:
  - if [ "$TRAVIS_BRANCH" == "master" -a "$TRAVIS_EVENT_TYPE" != "cron" ]; then
    docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    export REPO=keyfender/keyfender;
    docker tag $REPO:latest $REPO:${TRAVIS_COMMIT::7};
    docker tag $REPO:latest $REPO:travis-$TRAVIS_BUILD_NUMBER;
    docker push $REPO;
    fi
notifications:
  webhooks:
    urls:
    - "https://scalar.vector.im/api/neb/services/hooks/dHJhdmlzLWNpLyU0MHN2ZW4lM0FhNm4uZGUvJTIxQm1vQ2JOWUpVU0VLYnBKUWtPJTNBYTZuLmRl"
    on_success: change  # always|never|change
    on_failure: always
    on_start: never
